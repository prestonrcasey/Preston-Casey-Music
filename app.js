const Store={cartKey:'sp_cart',PRODUCTS:[],async loadProducts(){if(this.PRODUCTS.length)return this.PRODUCTS;const r=await fetch('data/products.json');this.PRODUCTS=await r.json();return this.PRODUCTS;},getCart(){try{return JSON.parse(localStorage.getItem(this.cartKey))||[]}catch(e){return[]}},saveCart(c){localStorage.setItem(this.cartKey,JSON.stringify(c));const b=document.getElementById('cart-count');if(b){const n=c.reduce((s,i)=>s+i.qty,0);b.textContent=n;b.style.display=n?'inline-block':'none';}},addToCart(id,qty=1){const c=this.getCart();const i=c.findIndex(x=>x.id===id);if(i>-1){c[i].qty+=qty}else{c.push({id,qty})}this.saveCart(c);},removeFromCart(id){this.saveCart(this.getCart().filter(i=>i.id!==id))}};function renderProducts(sel){Store.loadProducts().then(ps=>{const el=document.querySelector(sel);el.innerHTML='';ps.forEach(p=>{const d=document.createElement('div');d.className='card pad';d.innerHTML=`<img src="${p.cover}" alt="" style="width:100%;border-radius:10px"><h3>${p.title}</h3><div class='kicker'>${p.composer} • Grade ${p.grade} • ${p.duration}</div><div style='display:flex;justify-content:space-between;align-items:center'><strong>$${p.price.toFixed(2)}</strong><div><a class='btn' href='product.html?id=${p.id}'>Details</a> <button class='btn' data-id='${p.id}'>Add</button></div></div>`;el.appendChild(d)});el.querySelectorAll('button[data-id]').forEach(b=>b.onclick=()=>Store.addToCart(b.dataset.id,1));});}